import{i as y,c as I,j as de,o as ve,q as E,a as s,b as i,d as r,l as pe,s as F,F as J,g as K,x as me,h as A,t as S,k as fe,v as ye}from"./index-2a4a3604.js";import{_ as Q,u as _e}from"./_plugin-vue_export-helper-81752afc.js";const ge={class:"video-editor"},be={class:"player-container"},Te={key:0,class:"youtube-player-wrapper"},ke=["src"],he={class:"timeline"},$e=["onClick","title"],we={class:"playback-controls"},Se={class:"playback-info"},Be={class:"playback-buttons"},Ce={__name:"VideoEditor",props:{videoUrl:{type:String,required:!0},projectId:{type:[String,Number],required:!0},readOnly:{type:Boolean,default:!1}},emits:["update:loop-status","update:current-time","update:duration"],setup(T,{expose:U,emit:V}){const _=T,c=V,P=_e(),a=y(null),k=y(null);let t=null;const l=y(0),o=y(0),u=I(()=>_.videoUrl.includes("youtube.com")||_.videoUrl.includes("youtu.be")),D=I(()=>{if(!u.value)return null;if(_.videoUrl.includes("youtube.com/watch"))return new URL(_.videoUrl).searchParams.get("v");if(_.videoUrl.includes("youtu.be")){const e=_.videoUrl.split("/");return e[e.length-1].split("?")[0]}return null}),x=I(()=>P.sortedBreakpoints),h=y([]),v=y(null),d=y(null),B=y(3),M=y(1e3),g=y(!1),$=y(0);let L=null;const W=I(()=>l.value===0?0:o.value/l.value*100),Y=e=>{if(typeof e!="number"||isNaN(e))return"00:00.00";const n=Math.floor(e/60),f=Math.floor(e%60),b=Math.floor(e%1*100);return`${n.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}.${b.toString().padStart(2,"0")}`},p=e=>e===null||!x.value[e]?0:x.value[e].time,X=()=>{if(!a.value)return;const e=a.value.currentTime;if(o.value=e,c("update:current-time",o.value),g.value&&d.value!==null){const n=p(d.value);e>=n&&(console.log(`����ѭ����������: ��ǰʱ��=${e.toFixed(2)}, ������=${n.toFixed(2)}`),a.value.pause(),N())}},Z=()=>{a.value&&(l.value=a.value.duration,c("update:duration",l.value))},ee=e=>{e.preventDefault(),R()},R=async()=>{try{const e=u.value&&t?t.getCurrentTime():a.value?a.value.currentTime:o.value,n=u.value?t&&t.getPlayerState()===window.YT.PlayerState.PLAYING:a.value&&!a.value.paused;console.log("Adding breakpoint at time:",e),P.addBreakpoint({time:e,note:""}).catch(f=>{console.error("Failed to add breakpoint:",f)})}catch(e){console.error("Failed to add breakpoint:",e)}},te=e=>{const n=h.value.indexOf(e);if(n===-1){if(h.value.push(e),h.value.length===2){const[f,b]=h.value.sort((H,ce)=>H-ce);v.value=f,d.value=b,h.value=[]}}else h.value.splice(n,1)};let w=!1;const oe=async(e,n,f,b)=>{w=!1,v.value=e,d.value=n,B.value=f||3,M.value=b||1e3,!(v.value===null||d.value===null)&&(g.value=!0,$.value=0,c("update:loop-status",{isLooping:!0,currentCount:$.value,totalCount:B.value}),console.log(`��ʼѭ�����Ӷϵ�${v.value}(${p(v.value).toFixed(2)}��) ���ϵ�${d.value}(${p(d.value).toFixed(2)}��)����${B.value}��`),j())},O=()=>{if(!t||!g.value){m&&(clearInterval(m),m=null);return}const e=t.getCurrentTime();if(o.value=e,c("update:current-time",e),d.value!==null){const n=p(d.value);e>=n&&(console.log(`����YouTubeѭ����������: ��ǰʱ��=${e.toFixed(2)}, ������=${n.toFixed(2)}`),t.pauseVideo(),N())}},N=()=>{if(!w){if(w=!0,ae(),$.value++,console.log(`ѭ�� ${$.value}/${B.value} ���`),c("update:loop-status",{isLooping:!0,currentCount:$.value,totalCount:B.value}),$.value>=B.value){console.log("����ѭ�������"),q(),w=!1;return}console.log(`�ȴ� ${M.value} �����ʼ��һ��ѭ��`),clearTimeout(L),L=setTimeout(()=>{if(!g.value){console.log("ѭ���ѱ�ֹͣ��ȡ������ѭ��"),w=!1;return}console.log("��ʼ��һ��ѭ��"),j()},M.value)}},j=()=>{g.value&&(u.value&&t?(console.log(`��YouTube��Ƶ���õ���ʼ��: ${p(v.value).toFixed(2)}��`),t.seekTo(p(v.value),!0),t.playVideo(),m||(m=setInterval(O,100))):a.value&&(console.log(`��HTML5��Ƶ���õ���ʼ��: ${p(v.value).toFixed(2)}��`),a.value.currentTime=p(v.value),a.value.play().catch(e=>console.error("����ʧ��:",e))),w=!1)},ae=()=>{try{u.value&&t?t.pauseVideo():a.value&&a.value.pause()}catch(e){console.error("��ͣý��ʱ����:",e)}},q=()=>{console.log("ֹͣѭ��"),g.value=!1,$.value=0,w=!1,clearTimeout(L),c("update:loop-status",{isLooping:!1}),m&&(clearInterval(m),m=null)};let m=null;const G=()=>{if(!(!u.value||!D.value))if(!window.YT||!window.YT.Player){const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";const n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n),window.onYouTubeIframeAPIReady=()=>{z()}}else z()},z=()=>{k.value&&(t&&t.destroy(),t=new window.YT.Player("youtube-player",{height:"100%",width:"100%",videoId:D.value,playerVars:{playsinline:1,controls:1,enablejsapi:1},events:{onReady:le,onStateChange:ne}}))},le=e=>{l.value=t.getDuration(),c("update:duration",l.value),ue()},ne=e=>{e.data===window.YT.PlayerState.ENDED&&g.value&&(console.log("YouTube��Ƶ���Ž���������ѭ��"),N()),e.data===window.YT.PlayerState.PLAYING&&g.value&&(m||(console.log("����YouTube��ؼ��"),m=setInterval(O,100))),t&&(o.value=t.getCurrentTime(),c("update:current-time",o.value))};let C=null;const ue=()=>{C&&clearInterval(C),C=setInterval(()=>{t&&t.getPlayerState&&t.getPlayerState()===window.YT.PlayerState.PLAYING&&(o.value=t.getCurrentTime(),c("update:current-time",o.value))},100)};de(()=>_.videoUrl,e=>{u.value&&G()},{immediate:!0}),ve(()=>{u.value?G():ie()}),E(()=>{clearTimeout(L),m&&clearInterval(m),C&&clearInterval(C),t&&(t.destroy(),t=null)});const re=e=>{if(typeof e!="number"||isNaN(e)){console.error("Invalid time value for seeking:",e);return}console.log("Seeking to time:",e),u.value&&t?t.seekTo(e,!0):a.value&&(a.value.currentTime=e)},se=()=>u.value&&t?t.getCurrentTime():a.value?a.value.currentTime:o.value;U({seekTo:re,startLoop:oe,stopLoop:q});const ie=()=>{const e=setInterval(()=>{if(a.value&&!a.value.paused&&(o.value=a.value.currentTime,c("update:current-time",o.value),g.value&&d.value!==null)){const n=p(d.value);(o.value>=n-.1||o.value>=n)&&(console.log(`��ʱ����⵽HTML5��Ƶ����ѭ��������: ��ǰ${o.value}��, ������${n}��`),N())}},50);E(()=>{clearInterval(e)})};return(e,n)=>(s(),i("div",ge,[r("div",be,[u.value?(s(),i("div",Te,[r("div",{ref_key:"youtubePlayerRef",ref:k,id:"youtube-player"},null,512)])):(s(),i("video",{key:1,ref_key:"videoRef",ref:a,class:"video-player",controls:"",onTimeupdate:X,onLoadedmetadata:Z,onClick:pe(ee,["stop"]),src:T.videoUrl},null,40,ke)),r("div",he,[r("div",{class:"timeline-current",style:F({left:`${W.value}%`})},null,4),(s(!0),i(J,null,K(x.value,(f,b)=>(s(),i("div",{key:b,class:me(["breakpoint-marker",{active:h.value.includes(b)}]),style:F({left:`${f.time/l.value*100}%`}),onClick:H=>te(b),title:`Time: ${Y(f.time)}${f.note?" - "+f.note:""}`},null,14,$e))),128)),v.value!==null&&d.value!==null?(s(),i("div",{key:0,class:"loop-region",style:F({left:`${p(v.value)/l.value*100}%`,width:`${(p(d.value)-p(v.value))/l.value*100}%`})},null,4)):A("",!0)])]),r("div",we,[r("div",Se," Current Time: "+S(Y(o.value))+" / "+S(Y(l.value)),1),r("div",Be,[T.readOnly?A("",!0):(s(),i("button",{key:0,onClick:R,class:"btn btn-primary",type:"button","aria-label":"Add breakpoint at current time"}," Add Breakpoint ("+S(Y(se()))+") ",1))])])]))}},Ge=Q(Ce,[["__scopeId","data-v-5468921b"]]);const Ie={class:"breakpoint-list"},Pe={key:0,class:"empty-state"},Le={key:1,class:"breakpoint-items"},Ye={class:"breakpoint-info"},Ne={class:"breakpoint-index"},Ue={class:"breakpoint-time"},Ve={key:0,class:"breakpoint-note"},xe=["for"],Me=["id","name","placeholder","onUpdate:modelValue","onBlur"],Fe={key:1,class:"breakpoint-note-readonly"},Ee={class:"note-text"},Ae={class:"breakpoint-actions"},De=["onClick"],Re=["onClick"],Oe={__name:"BreakpointList",props:{breakpoints:{type:Array,required:!0},readOnly:{type:Boolean,default:!1}},emits:["update:note","remove","seek"],setup(T,{emit:U}){const V=T,_=U,c=I(()=>V.breakpoints.map((t,l)=>({...t,id:t.id||`bp-${Date.now()}-${l}-${Math.random().toString(36).substr(2,9)}`,index:l,note:t.note||""}))),P=t=>{if(typeof t!="number"||isNaN(t))return"00:00.00";const l=Math.floor(t/60),o=Math.floor(t%60),u=Math.floor(t%1*100);return`${l.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}.${u.toString().padStart(2,"0")}`},a=(t,l)=>{console.log(`Updating breakpoint ${t} with note: ${l}`),k[t]&&clearTimeout(k[t]),k[t]=setTimeout(()=>{_("update:note",{index:t,note:l})},500)},k={};return E(()=>{Object.values(k).forEach(t=>{clearTimeout(t)})}),(t,l)=>(s(),i("div",Ie,[l[1]||(l[1]=r("h3",{class:"breakpoint-list-title"},"Breakpoint List",-1)),c.value.length===0?(s(),i("div",Pe,l[0]||(l[0]=[r("p",null,'No breakpoints added yet. Click "Add Breakpoint" button during video playback',-1)]))):(s(),i("div",Le,[(s(!0),i(J,null,K(c.value,o=>(s(),i("div",{key:o.id,class:"breakpoint-item"},[r("div",Ye,[r("span",Ne,S(o.index+1),1),r("span",Ue,S(P(o.time)),1)]),T.readOnly?(s(),i("div",Fe,[r("p",Ee,S(o.note||"No notes"),1)])):(s(),i("div",Ve,[r("label",{for:`breakpoint-note-${o.id}`},"Breakpoint "+S(o.index+1)+" notes",9,xe),fe(r("input",{type:"text",id:`breakpoint-note-${o.id}`,name:`breakpoint-note-${o.id}`,placeholder:`Breakpoint #${o.index+1} notes...`,"onUpdate:modelValue":u=>o.note=u,onBlur:u=>a(o.index,o.note),class:"form-control","aria-label":"Breakpoint note"},null,40,Me),[[ye,o.note]])])),r("div",Ae,[T.readOnly?A("",!0):(s(),i("button",{key:0,class:"btn btn-sm btn-danger",onClick:u=>t.$emit("remove",o.index),title:"Delete breakpoint",type:"button"}," Delete ",8,De)),r("button",{class:"btn btn-sm btn-primary",onClick:u=>t.$emit("seek",o.time),title:"Jump to this timestamp",type:"button"}," Jump ",8,Re)])]))),128))]))]))}},ze=Q(Oe,[["__scopeId","data-v-abe12010"]]);export{ze as B,Ge as V};
